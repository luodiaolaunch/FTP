fixed the main program bugs!
